<!DOCTYPE html>
<html>

<head>
    <title>Pago con Culqi</title>

    <!-- Incluimos jQuery, que facilita la manipulación de HTML y el envío de datos -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Incluimos Bootstrap para mejorar el estilo y diseño de la página -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Incluimos el script de Culqi para procesar pagos -->
    <script src="https://checkout.culqi.com/js/v4"></script>
</head>

<body>
    
    <script>
        // Establecemos la clave pública de Culqi para autenticar la transacción
        Culqi.publicKey = 'pk_test_1e3464ded7850f8c';

        Culqi.settings({
                title: 'Fia Fit',
                currency: 'PEN',  // Moneda en la que se procesará el pago (Soles peruanos)
                amount: 1000,  // Monto en centavos (1000 centavos = 10.00 PEN)
            });

            // Opciones adicionales para el formulario, como el idioma y los métodos de pago permitidos
            Culqi.options({
                lang: "auto",
                installments: false, // Deshabilitamos la opción de cuotas
                paymentMethods: {
                    tarjeta: true,
                    yape: true,
                    bancaMovil: true,
                    agente: true,
                    billetera: true,
                    cuotealo: true,
                },
                style: {
                    logo: "https://s4.aconvert.com/convert/p3r68-cdx67/aale4-nm7pc.webp", // Logo del comercio
                }
            });

            // Abre el formulario de Culqi cuando se hace clic en el botón de pagar
            Culqi.open();
            e.preventDefault(); // Prevenimos que la página se recargue
            

        // Función que se ejecuta al finalizar el proceso de pago
        function culqi() {
            if (Culqi.token) {  // Si se genera un token correctamente
                const token = Culqi.token.id;
                const email = Culqi.token.email;
                console.log('Se ha creado un Token: ', token);

                // Aquí enviarías el token generado al servidor para procesar el pago (comentado para pruebas)
                /*$.ajax({
                    url: "procesarPago.php",
                    type: "POST",  // Enviar datos al servidor
                    data: {
                        token: token,
                        email: email
                    }
                }).done(function (resp) {
                    alert(resp);  // Muestra la respuesta del servidor
                });*/

            } else if (Culqi.order) {  // Si se genera un pedido correctamente
                const order = Culqi.order;
                console.log('Se ha creado el objeto Order: ', order);

            } else {
                // En caso de error, mostramos el mensaje en la consola
                console.log('Error : ', Culqi.error);
            }
        };
    </script>

    <!-- Scripts adicionales para que Bootstrap funcione correctamente -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
</body>

</html>